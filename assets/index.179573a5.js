import{j as h,r as u,B as w,F as D,A as N,R as b,a as x}from"./vendor.aaefd341.js";const _=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}};_();const f={"Blade sharpening":{streamName:"blade.sharpening",window:5},"Oil change":{streamName:"oil.change",window:5},"Oil filter change":{streamName:"oil.filter.change",window:5},"Air filter":{streamName:"air.filter",window:5},"Cleaning / Powerwash":{streamName:"cleaning.powerwash",window:5}},M=r=>{const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=["January","February","March","April","May","June","July","August","September","October","November","December"],a=new Date(r),e=n[a.getDay()],t=s[a.getMonth()];return`Last service: ${e}, ${t} ${a.getDate()}`},L=(r,n)=>{let a=v(r)+n;const e=v(Date.now());a>365&&e<=n&&(a=a-365);const t=a-e;return t===0?["Next service: by today","today"]:t>0?[`Next service: in ${t} day(s)`,"good"]:[`Next service: by ${t*-1} day(s) ago`,"overdue"]},v=r=>{var n=new Date(r),s=new Date(n.getFullYear(),0,0),a=n-s+(s.getTimezoneOffset()-n.getTimezoneOffset())*60*1e3,e=1e3*60*60*24,t=Math.floor(a/e);return t},O="_bottom_33c8p_13",A="_top_33c8p_23",T="_time_33c8p_33",$="_btn_33c8p_46",C="_item_33c8p_1";var l={"item-container":"_item-container_33c8p_1",bottom:O,top:A,time:T,"time-today":"_time-today_33c8p_39","time-overdue":"_time-overdue_33c8p_42",btn:$,item:C};const o=h.exports.jsx,y=h.exports.jsxs,g=({name:r,lastServiceDate:n,nextServiceDate:s,serviceStatus:a,maintenanceType:e,getLatestStreams:t})=>{const[i,c]=u.exports.useState(!1),d=async()=>{c(!0),await(await D.getCurrentDevice()).sendCommand("perform.maintenance",e),await m(6e3),c(!1)},m=p=>new Promise(S=>setTimeout(S,p));return y("div",{className:l["item-container"],children:[y("div",{className:l.top,children:[o("span",{className:l.time,children:n}),o("span",{className:`${l.time} ${l[`time-${a}`]}`,children:s})]}),y("div",{className:l.bottom,children:[o("span",{className:l.item,children:r}),o(w,{disabled:i,type:"primary",size:"small",onClick:d,className:l.btn,children:"Mark Complete"})]})]})},j=({device:r})=>{const[n,s]=u.exports.useState(),[a,e]=u.exports.useState([]);u.exports.useLayoutEffect(()=>{t()},[r]);const t=async()=>{if(r){const c=(await r.getLatestTelemetry()).filter(m=>m.currentValue==="Maintenance performed"),d=c.map(m=>m.streamName);s(c),e(d)}};return o("div",{children:!!n&&Object.keys(f).map((i,c)=>{if((a==null?void 0:a.length)>0){const d=a.indexOf(f[i].streamName);if(d>=0){const m=new Date(n[d].currentValueTime),p=L(m,f[i].window);return o(g,{name:i,lastServiceDate:M(m)||"--:--",nextServiceDate:p[0]||"--:--",serviceStatus:p[1],maintenanceType:f[i].streamName,getLatestStreams:t},c)}}return o(g,{name:i,lastServiceDate:"Last service: More than 20 days ago",nextServiceDate:"Next Service: Overdue for more than 15 days",serviceStatus:"overdue",maintenanceType:f[i].streamName,getLatestStreams:t},c)})})},F=()=>{const[r,n]=u.exports.useState();u.exports.useEffect(()=>{s()},[]);const s=async()=>{if(await N.waitTilAuthenticated()){const a=await D.getCurrentDevice();n(a)}};return o("div",{className:"App",children:o(j,{device:r})})};b.render(o(x.StrictMode,{children:o(F,{})}),document.getElementById("root"));
