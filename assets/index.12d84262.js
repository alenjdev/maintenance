import{j as h,r as u,B as S,F as D,A as w,R as N,a as b}from"./vendor.aaefd341.js";const x=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}};x();const p={"Blade sharpening":{streamName:"blade.sharpening",window:5},"Oil change":{streamName:"oil.change",window:5},"Oil filter change":{streamName:"oil.filter.change",window:5},"Air filter":{streamName:"air.filter",window:5},"Cleaning / Powerwash":{streamName:"cleaning.powerwash",window:5}},_=r=>{const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=["January","February","March","April","May","June","July","August","September","October","November","December"],a=new Date(r),e=n[a.getDay()],t=i[a.getMonth()];return`Last service: ${e}, ${t} ${a.getDate()}`},M=(r,n)=>{let a=v(r)+n;const e=v(Date.now());a>365&&e<=n&&(a=a-365);const t=a-e;return t===0?["Next service: by today","today"]:t>0?[`Next service: in ${t} day(s)`,"good"]:[`Next service: by ${t*-1} day(s) ago`,"overdue"]},v=r=>{var n=new Date(r),i=new Date(n.getFullYear(),0,0),a=n-i+(i.getTimezoneOffset()-n.getTimezoneOffset())*60*1e3,e=1e3*60*60*24,t=Math.floor(a/e);return t},O="_bottom_33c8p_13",L="_top_33c8p_23",A="_time_33c8p_33",T="_btn_33c8p_46",$="_item_33c8p_1";var m={"item-container":"_item-container_33c8p_1",bottom:O,top:L,time:A,"time-today":"_time-today_33c8p_39","time-overdue":"_time-overdue_33c8p_42",btn:T,item:$};const o=h.exports.jsx,y=h.exports.jsxs,g=({name:r,lastServiceDate:n,nextServiceDate:i,serviceStatus:a,maintenanceType:e})=>{const[t,s]=u.exports.useState(!1),l=async()=>{s(!0),await(await D.getCurrentDevice()).sendCommand("perform.maintenance",e),await d(6e3),s(!1)},d=c=>new Promise(f=>setTimeout(f,c));return y("div",{className:m["item-container"],children:[y("div",{className:m.top,children:[o("span",{className:m.time,children:n}),o("span",{className:`${m.time} ${m[`time-${a}`]}`,children:i})]}),y("div",{className:m.bottom,children:[o("span",{className:m.item,children:r}),o(S,{disabled:t,type:"primary",size:"small",onClick:l,className:m.btn,children:"Mark Complete"})]})]})},C=({device:r})=>{const[n,i]=u.exports.useState(),[a,e]=u.exports.useState([]);u.exports.useLayoutEffect(()=>{t()},[r]);const t=async()=>{if(r){const l=(await r.getLatestTelemetry()).filter(c=>c.currentValue==="Maintenance performed"),d=l.map(c=>c.streamName);i(l),e(d)}};return o("div",{children:!!n&&Object.keys(p).map((s,l)=>{if((a==null?void 0:a.length)>0){const d=a.indexOf(p[s].streamName);if(d>=0){const c=new Date(n[d].currentValueTime),f=M(c,p[s].window);return o(g,{name:s,lastServiceDate:_(c)||"--:--",nextServiceDate:f[0]||"--:--",serviceStatus:f[1],maintenanceType:p[s].streamName},l)}}return o(g,{name:s,lastServiceDate:"Last service: More than 20 days ago",nextServiceDate:"Next Service: Overdue for more than 15 days",serviceStatus:"overdue",maintenanceType:p[s].streamName},l)})})},j=()=>{const[r,n]=u.exports.useState();u.exports.useEffect(()=>{i()},[]);const i=async()=>{if(await w.waitTilAuthenticated()){const a=await D.getCurrentDevice();n(a)}};return o("div",{className:"App",children:o(C,{device:r})})};N.render(o(b.StrictMode,{children:o(j,{})}),document.getElementById("root"));
